!function(e){"function"==typeof define&&define.amd&&define(["jquery"],e)}(function(e,n,t){"use strict";function l(e,n,t){return t=void 0!==t?t:"",e.is("[id]")||e.attr("id",n+t),e.attr("id")}function d(e){return e.shiftKey||e.ctrlKey||e.altKey||e.metaKey?!e.shiftKey||e.ctrlKey||e.altKey||e.metaKey?!1:"shift":"none"}function c(e){return e.find("a[href], area[href], button:enabled, input:enabled, textarea:enabled, select:enabled, optgroup:enabled, option:enabled, menuitem:enabled, fieldset:enabled")}function r(n,t){var i=this;i.settings=e.extend({},e.fn[a].defaultSettings,t),i.element=e(n),i.elementId=l(i.element,i.settings.dialogIdPrefix,s),i.elementState=!1,i.elements={wrapper:i.element.find("."+i.settings.wrapperClass),container:i.element.find("."+i.settings.containerClass),heading:i.element.find("."+i.settings.headingClass),mainMessage:i.element.find("."+i.settings.mainMessageClass).first()},i.init()}var a="ariaDialog",s=0,i={r:"role",aMo:"aria-modal",aHi:"aria-hidden",aLab:"aria-labelledby",aDes:"aria-describedby",tbI:"tabindex",aLi:"aria-live",t:"true",f:"false"},o=e(n);e.extend(r.prototype,{init:function(){var e=this,n=e.settings,d=e.element,r=e.elements,f=r.wrapper;switch(n.cssTransitions||(d.hide(),f.hide()),n.dialogType){case"modal":f.attr(i.r,"dialog").attr(i.aMo,i.t);break;case"alert":f.attr(i.r,"alertdialog").attr(i.aMo,i.t)}if(f.attr(i.aLab,l(r.heading,e.elementId+"__heading")).attr(i.aHi,i.t).attr(i.tbI,"-1"),1===r.mainMessage.length&&f.attr(i.aDes,l(r.mainMessage,e.elementId+"__main-message")),r.focussableElements=c(f),r.elementToFocus=f.find(n.setFocusOn),"object"!=typeof r.elementToFocus||1!==r.elementToFocus.length||1!==r.elementToFocus.closest(e.element).length||r.focussableElements.index(r.elementToFocus)<0)throw new Error("Check value of 'setFocusOn' option.");n.deepLinking&&(e.deepLinkingController(),o.on("hashchange",function(){t.location.hash==="#"+e.elementId?e.show():e.elementState&&e.deepLinkingController()})),o.trigger(a+".initialised",[e]),s+=1},show:function(){var n=this,t=n.element,s=n.elements,l=s.wrapper,r=n.settings,f=c(l),u=f.first(),p=f.last();n.elementWithFocus=e(":focus"),r.cssTransitions||(t.show(),l.stop().fadeIn(r.fadeSpeed)),t.addClass(r.dialogOpenClass),l.addClass(r.wrapperOpenClass).attr(i.aHi,i.f),s.elementToFocus.focus(),u.on("keydown."+a,function(e){9===e.keyCode&&"shift"===d(e)&&(e.preventDefault(),p.focus())}),p.first().on("keydown."+a,function(e){9===e.keyCode&&"none"===d(e)&&(e.preventDefault(),u.focus())}),r.closeWithEsc&&o.on("keydown."+a,function(e){27===e.keyCode&&"none"===d(e)&&(r.deepLinking?n.updateHash():n.hide())}),r.closeOnBgClick&&(t.on("click."+a,function(){r.deepLinking?n.updateHash():n.hide()}),l.on("click."+a,function(e){e.stopPropagation()})),r.closeWithEsc&&o.on("keydown."+a,function(e){27===e.keyCode&&"none"===d(e)&&n.updateHash("hide")}),r.closeOnBgClick&&(t.on("click."+a,function(){n.updateHash("hide")}),l.on("click."+a,function(e){e.stopPropagation()})),n.elementState=!0,o.trigger(a+".show",[n])},hide:function(){var e=this,n=e.element,t=e.elements.wrapper,s=e.settings;n.removeClass(s.dialogOpenClass),t.removeClass(s.wrapperOpenClass).attr(i.aHi,i.t),s.cssTransitions||t.stop().fadeOut(s.fadeSpeed,function(){n.hide()}),1===e.elementWithFocus.length&&e.elementWithFocus.focus(),o.off("keydown."+a),n.off("click."+a),t.off("click."+a),e.elementState=!1,o.trigger(a+".hide",[e])},updateHash:function(e){"show"===e?t.location.hash=this.elementId:t.location.hash=""},deepLinkingController:function(){var e=this;t.location.hash==="#"+e.elementId?e.show():e.elementState&&e.hide()},methodCaller:function(e){var n=this;if(n.settings.deepLinking)n.updateHash(e);else switch(e){case"show":n.show();break;case"hide":n.elementState&&n.hide()}}}),e.fn[a]=function(n){return this.each(function(){e.data(this,"plugin_"+a)||"object"!=typeof n&&"undefined"!=typeof n?"string"==typeof n&&e.data(this,"plugin_"+a).methodCaller(n):e.data(this,"plugin_"+a,new r(this,n))})},e.fn[a].defaultSettings={dialogIdPrefix:"dialog--",wrapperClass:"dialog__wrapper",containerClass:"dialog__container",headingClass:"dialog__heading",mainMessageClass:"dialog__main-message",dialogOpenClass:"dialog_open",wrapperOpenClass:"dialog__wrapper_open",dialogType:"modal",containerRole:"document",closeWithEsc:!0,closeOnBgClick:!0,fadeSpeed:600,cssTransitions:!1,deepLinking:!1,setFocusOn:"button:first-child"}}(jQuery,window,document));